<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PL Asks ‚Äî Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,400;0,8..60,600;1,8..60,400&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --pl-black: #000000;
    --pl-green: #21B573;
    --pl-green-dark: #1A9A62;
    --pl-teal: #0FCCCE;
    --pl-green-light: #E9F7F0;
    --gray: #333333;
    --gray-100: #666666;
    --gray-80: #878787;
    --gray-50: #949494;
    --gray-light: #F5F5F1;
    --white: #FFFFFF;
    --border: #E2E2DD;
    --card-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 4px 14px rgba(0,0,0,0.04);
    --card-shadow-hover: 0 2px 8px rgba(0,0,0,0.07), 0 8px 28px rgba(0,0,0,0.07);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background: var(--gray-light); color: var(--pl-black);
    -webkit-font-smoothing: antialiased;
  }

  /* === LOADING === */
  .loading-overlay {
    position: fixed; inset: 0; background: var(--gray-light);
    display: flex; align-items: center; justify-content: center; flex-direction: column;
    z-index: 1000; transition: opacity 0.4s ease;
  }
  .loading-overlay.hidden { opacity: 0; pointer-events: none; }
  .loading-spinner {
    width: 40px; height: 40px; border: 3px solid var(--border);
    border-top-color: var(--pl-green); border-radius: 50%;
    animation: spin 0.8s linear infinite; margin-bottom: 16px;
  }
  .loading-text { font-size: 14px; color: var(--gray-80); }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* === ERROR === */
  .error-banner {
    background: #FEF2F2; border: 1px solid #FECACA; color: #991B1B;
    padding: 16px 24px; border-radius: 10px; margin: 24px auto; max-width: 600px;
    font-size: 14px; text-align: center; display: none;
  }
  .error-banner.show { display: block; }

  /* === HERO === */
  .hero {
    background: linear-gradient(135deg, #21B573 0%, #0FCCCE 50%, #21B5A0 100%);
    padding: 56px 0 52px; position: relative; overflow: hidden;
  }
  .hero::after {
    content: ''; position: absolute; inset: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    pointer-events: none;
  }
  .container { max-width: 1080px; margin: 0 auto; padding: 0 32px; position: relative; z-index: 1; }
  .hero-top {
    display: flex; align-items: center; gap: 12px; margin-bottom: 24px;
    animation: fadeInUp 0.6s ease;
  }
  .hero-logo { width: 32px; height: 32px; opacity: 0.9; }
  .hero-label {
    font-size: 13px; font-weight: 500; color: rgba(255,255,255,0.8);
    letter-spacing: 0.5px; text-transform: uppercase;
  }
  .hero h1 {
    font-size: 40px; font-weight: 700; color: var(--white);
    line-height: 1.15; margin-bottom: 14px; letter-spacing: -0.5px;
    animation: fadeInUp 0.6s ease 0.1s both;
  }
  .hero p {
    font-size: 16px; color: rgba(255,255,255,0.75); max-width: 580px; line-height: 1.6;
    animation: fadeInUp 0.6s ease 0.2s both;
  }
  .hero .data-disclaimer {
    display: inline-block; margin-top: 18px; padding: 6px 14px;
    background: rgba(0,0,0,0.15); border-radius: 6px;
    font-size: 12px; color: rgba(255,255,255,0.7);
    animation: fadeInUp 0.6s ease 0.3s both;
  }

  /* === DATE RANGE PICKER === */
  .date-picker-bar {
    max-width: 1080px; margin: 20px auto 0; padding: 0 32px; position: relative; z-index: 3;
  }
  .date-picker-inner {
    background: var(--white); border-radius: 12px; padding: 16px 24px;
    box-shadow: var(--card-shadow); border: 1px solid var(--border);
    display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
  }
  .dp-label {
    font-size: 13px; font-weight: 600; color: var(--gray);
    white-space: nowrap;
  }
  .dp-presets {
    display: flex; gap: 6px; flex-wrap: wrap;
  }
  .dp-preset {
    padding: 6px 14px; border-radius: 100px; border: 1px solid var(--border);
    background: var(--white); font-size: 12px; font-weight: 500;
    color: var(--gray-100); cursor: pointer; transition: all 0.2s ease;
    font-family: inherit;
  }
  .dp-preset:hover { border-color: var(--pl-green); color: var(--pl-green-dark); }
  .dp-preset.active {
    background: var(--pl-green); color: white; border-color: var(--pl-green);
  }
  .dp-sep {
    width: 1px; height: 28px; background: var(--border); flex-shrink: 0;
  }
  .dp-custom {
    display: flex; align-items: center; gap: 8px;
  }
  .dp-custom label {
    font-size: 11px; color: var(--gray-80); text-transform: uppercase;
    letter-spacing: 0.5px; font-weight: 500;
  }
  .dp-input {
    padding: 6px 10px; border: 1px solid var(--border); border-radius: 8px;
    font-size: 13px; font-family: inherit; color: var(--gray);
    background: var(--gray-light); width: 140px; transition: border-color 0.2s;
  }
  .dp-input:focus { outline: none; border-color: var(--pl-green); }
  .dp-apply {
    padding: 6px 16px; border-radius: 8px; border: none;
    background: var(--pl-green); color: white; font-size: 12px;
    font-weight: 600; cursor: pointer; font-family: inherit;
    transition: all 0.2s;
  }
  .dp-apply:hover { background: var(--pl-green-dark); }

  /* === STATS === */
  .stats-row {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;
    margin-top: 16px; position: relative; z-index: 2;
    padding: 0 32px; max-width: 1080px; margin-left: auto; margin-right: auto;
  }
  .stat-card {
    background: var(--white); border-radius: 12px; padding: 28px 24px;
    box-shadow: var(--card-shadow); border: 1px solid var(--border);
    transition: all 0.3s ease;
  }
  .stat-card:hover { box-shadow: var(--card-shadow-hover); transform: translateY(-2px); }
  .stat-number {
    font-family: 'Source Code Pro', monospace; font-size: 36px; font-weight: 600;
    color: var(--pl-green); line-height: 1; margin-bottom: 6px;
  }
  .stat-label { font-size: 13px; font-weight: 500; color: var(--gray-100); }
  .stat-detail {
    font-size: 11px; color: var(--gray-80); margin-top: 8px;
    padding-top: 8px; border-top: 1px solid var(--border);
  }

  /* === MAIN === */
  .main { padding: 48px 0 64px; }
  .section-title {
    font-size: 12px; font-weight: 600; color: var(--pl-green-dark);
    letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 20px;
  }

  /* === CATEGORIES === */
  .categories-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 48px; }
  .cat-chart {
    background: var(--white); border-radius: 12px; padding: 32px;
    box-shadow: var(--card-shadow); border: 1px solid var(--border);
  }
  .cat-chart h3 { font-size: 18px; font-weight: 600; margin-bottom: 24px; }
  .bar-row { display: flex; align-items: center; margin-bottom: 14px; gap: 12px; }
  .bar-label {
    font-size: 12.5px; font-weight: 500; color: var(--gray-100);
    min-width: 155px; text-align: right; flex-shrink: 0;
  }
  .bar-track { flex: 1; height: 22px; background: var(--gray-light); border-radius: 6px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 6px; transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1); }
  .bar-fill.c0 { background: linear-gradient(90deg, #21B573, #0FCCCE); }
  .bar-fill.c1 { background: var(--pl-green); }
  .bar-fill.c2 { background: #33C484; }
  .bar-fill.c3 { background: #4DD396; }
  .bar-fill.c4 { background: #73DFAF; }
  .bar-fill.c5 { background: #99E8C5; }
  .bar-fill.c6 { background: #B5EFDA; }
  .bar-fill.c7 { background: #D0F5E8; }
  .bar-value {
    font-family: 'Source Code Pro', monospace; font-size: 11.5px;
    font-weight: 600; color: var(--gray-100); min-width: 28px; flex-shrink: 0;
  }

  /* === RESOLUTION RING === */
  .resolution-card {
    background: var(--white); border-radius: 12px; padding: 32px;
    box-shadow: var(--card-shadow); border: 1px solid var(--border);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  .ring-container { position: relative; width: 160px; height: 160px; margin-bottom: 16px; }
  .ring-container svg { transform: rotate(-90deg); width: 160px; height: 160px; }
  .ring-bg { fill: none; stroke: var(--gray-light); stroke-width: 12; }
  .ring-fill {
    fill: none; stroke: url(#ringGrad); stroke-width: 12; stroke-linecap: round;
    stroke-dasharray: 408; stroke-dashoffset: 408;
    transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .ring-label { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
  .ring-label .big {
    font-family: 'Source Code Pro', monospace; font-size: 32px; font-weight: 600;
    color: var(--pl-green); display: block; line-height: 1;
  }
  .ring-label .small { font-size: 11px; color: var(--gray-80); margin-top: 2px; }
  .resolution-card h3 { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
  .resolution-card .sub { font-size: 12px; color: var(--gray-80); text-align: center; }
  .breakdown-row { display: flex; justify-content: space-between; margin-bottom: 8px; width: 100%; }
  .breakdown-label { font-size: 12px; color: var(--gray-80); }
  .breakdown-val { font-family: 'Source Code Pro', monospace; font-size: 12px; font-weight: 600; }

  /* === FLOW === */
  .flow-section { margin-bottom: 48px; }
  .flow-cards { display: grid; grid-template-columns: 1fr auto 1fr auto 1fr; gap: 0; align-items: center; }
  .flow-card {
    background: var(--white); border-radius: 12px; padding: 28px 24px;
    box-shadow: var(--card-shadow); border: 1px solid var(--border);
    text-align: center; transition: all 0.3s ease;
  }
  .flow-card:hover { box-shadow: var(--card-shadow-hover); transform: translateY(-2px); }
  .flow-num {
    width: 36px; height: 36px;
    background: linear-gradient(135deg, #21B573, #0FCCCE);
    color: white; border-radius: 50%;
    display: inline-flex; align-items: center; justify-content: center;
    font-family: 'Source Code Pro', monospace; font-weight: 600; font-size: 15px;
    margin-bottom: 14px;
  }
  .flow-card h4 { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
  .flow-card p { font-size: 13px; color: var(--gray-100); line-height: 1.55; }
  .flow-arrow { display: flex; align-items: center; justify-content: center; padding: 0 8px; }
  .flow-arrow svg { width: 32px; height: 32px; color: var(--pl-green); opacity: 0.4; }

  /* === PILLS === */
  .pills-section { margin-bottom: 48px; }
  .pills-wrap { display: flex; flex-wrap: wrap; gap: 10px; }
  .pill {
    display: inline-flex; align-items: center; gap: 8px;
    background: var(--white); border: 1px solid var(--border);
    border-radius: 100px; padding: 10px 18px;
    font-size: 13px; font-weight: 500; color: var(--gray-100); transition: all 0.25s ease;
  }
  .pill:hover { border-color: var(--pl-green); color: var(--pl-green-dark); background: var(--pl-green-light); }
  .pill .pi { font-size: 16px; flex-shrink: 0; }

  /* === TESTIMONIALS === */
  .testimonials { margin-bottom: 48px; }
  .testimonial-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
  .testimonial-card {
    background: var(--white); border-radius: 12px; padding: 28px 24px 24px;
    box-shadow: var(--card-shadow); border: 1px solid var(--border);
    transition: all 0.3s ease; position: relative;
  }
  .testimonial-card:hover { box-shadow: var(--card-shadow-hover); }
  .quote-mark {
    font-family: 'Source Serif 4', Georgia, serif;
    font-size: 48px; font-weight: 600; line-height: 1;
    color: var(--pl-green); margin-bottom: 8px; display: block;
  }
  .testimonial-card .quote {
    font-family: 'Source Serif 4', Georgia, serif;
    font-size: 14.5px; color: var(--gray); line-height: 1.65;
    font-style: italic; margin-bottom: 20px;
  }
  .testimonial-card .attribution { font-size: 14px; font-weight: 600; color: var(--pl-green-dark); margin-bottom: 2px; }
  .testimonial-card .attr-role { font-size: 12px; color: var(--gray-80); font-weight: 400; }

  /* === CTA === */
  .cta-section {
    background: var(--pl-black); border-radius: 14px; padding: 48px;
    text-align: center; position: relative; overflow: hidden;
  }
  .cta-section::before {
    content: ''; position: absolute; top: -60%; left: 50%; transform: translateX(-50%);
    width: 700px; height: 500px;
    background: radial-gradient(circle, rgba(33,181,115,0.12) 0%, transparent 70%);
    pointer-events: none;
  }
  .cta-section h2 { font-size: 26px; font-weight: 700; color: var(--white); margin-bottom: 10px; position: relative; }
  .cta-section p { font-size: 15px; color: rgba(255,255,255,0.5); margin-bottom: 28px; position: relative; }
  .cta-btn {
    display: inline-flex; align-items: center; gap: 8px;
    background: linear-gradient(135deg, #21B573, #0FCCCE);
    color: white; border: none; border-radius: 10px;
    padding: 14px 32px; font-family: 'Helvetica Neue', Helvetica, sans-serif;
    font-size: 15px; font-weight: 600; cursor: pointer;
    transition: all 0.25s ease; position: relative; text-decoration: none;
  }
  .cta-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(33,181,115,0.4); }

  /* === FOOTER === */
  .footer { text-align: center; padding: 32px 0; font-size: 12px; color: var(--gray-80); }
  .footer .updated { margin-top: 4px; font-size: 11px; color: var(--gray-50); }

  @keyframes fadeInUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
  .animate-in { opacity: 0; transform: translateY(16px); transition: all 0.6s ease; }
  .animate-in.visible { opacity: 1; transform: translateY(0); }

  @media (max-width: 768px) {
    .stats-row { grid-template-columns: repeat(2, 1fr); }
    .categories-grid { grid-template-columns: 1fr; }
    .flow-cards { grid-template-columns: 1fr; gap: 12px; }
    .flow-arrow { transform: rotate(90deg); padding: 4px 0; }
    .testimonial-grid { grid-template-columns: 1fr; }
    .hero h1 { font-size: 28px; }
    .stat-number { font-size: 28px; }
    .dp-sep { display: none; }
    .date-picker-inner { gap: 10px; }
  }
</style>
</head>
<body>

<svg width="0" height="0" style="position:absolute">
  <defs>
    <linearGradient id="ringGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#21B573"/>
      <stop offset="100%" style="stop-color:#0FCCCE"/>
    </linearGradient>
  </defs>
</svg>

<div class="loading-overlay" id="loader">
  <div class="loading-spinner"></div>
  <div class="loading-text">Loading live data from Google Sheet...</div>
</div>

<div class="error-banner" id="error"></div>

<!-- HERO -->
<div class="hero">
  <div class="container">
    <div class="hero-top">
      <svg class="hero-logo" viewBox="0 0 64 64" fill="none">
        <path d="M32 4L4 20v24l28 16 28-16V20L32 4z" fill="rgba(255,255,255,0.15)" stroke="white" stroke-width="2"/>
        <path d="M32 4L4 20l28 16 28-16L32 4z" fill="rgba(255,255,255,0.1)"/>
        <path d="M32 36v28l28-16V24L32 36z" fill="rgba(255,255,255,0.2)"/>
      </svg>
      <span class="hero-label">Protocol Labs &middot; PL Asks</span>
    </div>
    <h1>We help founders move faster.</h1>
    <p>PL Asks is a high-leverage support system designed to remove your biggest blockers through network expertise, warm intros, and targeted resources.</p>
    <div class="data-disclaimer" id="data-disclaimer">üìä Data shown: All time</div>
  </div>
</div>

<!-- DATE RANGE PICKER -->
<div class="date-picker-bar">
  <div class="date-picker-inner">
    <span class="dp-label">üìÖ Time Period</span>
    <div class="dp-presets">
      <button class="dp-preset active" data-range="all">All Time</button>
      <button class="dp-preset" data-range="365">Last 12 Months</button>
      <button class="dp-preset" data-range="180">Last 6 Months</button>
      <button class="dp-preset" data-range="90">Last 90 Days</button>
      <button class="dp-preset" data-range="30">Last 30 Days</button>
    </div>
    <div class="dp-sep"></div>
    <div class="dp-custom">
      <label>From</label>
      <input type="date" class="dp-input" id="dp-from">
      <label>To</label>
      <input type="date" class="dp-input" id="dp-to">
      <button class="dp-apply" id="dp-apply">Apply</button>
    </div>
  </div>
</div>

<!-- STATS -->
<div class="stats-row">
  <div class="stat-card">
    <div class="stat-number" id="s-total">--</div>
    <div class="stat-label">Asks Addressed</div>
    <div class="stat-detail" id="s-total-sub">Loading...</div>
  </div>
  <div class="stat-card">
    <div class="stat-number" id="s-teams">--</div>
    <div class="stat-label">Teams Supported</div>
    <div class="stat-detail">Across the PL portfolio</div>
  </div>
  <div class="stat-card">
    <div class="stat-number" id="s-response">--</div>
    <div class="stat-label">Median First Response</div>
    <div class="stat-detail" id="s-response-sub">Loading...</div>
  </div>
  <div class="stat-card">
    <div class="stat-number" id="s-close">--</div>
    <div class="stat-label">Median Resolution</div>
    <div class="stat-detail">From submit to close</div>
  </div>
</div>

<!-- MAIN -->
<div class="main"><div class="container">

  <div class="section-title animate-in">What Founders Ask For</div>
  <div class="categories-grid animate-in">
    <div class="cat-chart">
      <h3>Asks by Category</h3>
      <div id="bars-container"></div>
    </div>
    <div class="resolution-card">
      <div class="ring-container">
        <svg viewBox="0 0 160 160">
          <circle class="ring-bg" cx="80" cy="80" r="65"/>
          <circle class="ring-fill" id="ring" cx="80" cy="80" r="65"/>
        </svg>
        <div class="ring-label">
          <span class="big" id="ring-pct">--%</span>
          <span class="small">addressed</span>
        </div>
      </div>
      <h3>Resolution Rate</h3>
      <div class="sub">Fully + partially addressed asks</div>
      <div id="breakdown-container" style="margin-top: 24px; width: 100%; padding-top: 20px; border-top: 1px solid var(--border);"></div>
    </div>
  </div>

  <div class="flow-section animate-in">
    <div class="section-title">How It Works</div>
    <div class="flow-cards">
      <div class="flow-card">
        <div class="flow-num">1</div>
        <h4>Submit</h4>
        <p>Share your ask via your TG group, investor update, quarterly survey, or directly to your PL point of contact.</p>
      </div>
      <div class="flow-arrow"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M5 12h14m-6-6 6 6-6 6"/></svg></div>
      <div class="flow-card">
        <div class="flow-num">2</div>
        <h4>Triage</h4>
        <p>We categorize, prioritize, and route your ask to the right person or resource in the network.</p>
      </div>
      <div class="flow-arrow"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M5 12h14m-6-6 6 6-6 6"/></svg></div>
      <div class="flow-card">
        <div class="flow-num">3</div>
        <h4>Resolve</h4>
        <p>Warm 1-1 intros over Telegram, expert playbooks, network peers, or the PL team step in. We close the loop.</p>
      </div>
    </div>
  </div>

  <div class="pills-section animate-in">
    <div class="section-title">What We Cover</div>
    <div class="pills-wrap">
      <div class="pill"><span class="pi">üöÄ</span> GTM & Growth Strategy</div>
      <div class="pill"><span class="pi">üí∞</span> Fundraising & Investor Intros</div>
      <div class="pill"><span class="pi">üì£</span> Social & Ecosystem Amplification</div>
      <div class="pill"><span class="pi">üë•</span> Hiring & Talent</div>
      <div class="pill"><span class="pi">üé®</span> Product & UX Feedback</div>
      <div class="pill"><span class="pi">‚öñÔ∏è</span> Legal & Compliance</div>
      <div class="pill"><span class="pi">üîê</span> Audit Referrals</div>
      <div class="pill"><span class="pi">ü™ô</span> Tokenomics & Token Design</div>
      <div class="pill"><span class="pi">üõ†Ô∏è</span> Developer Outreach & Distribution</div>
    </div>
  </div>

  <div class="testimonials animate-in">
    <div class="section-title">What Founders Say</div>
    <div class="testimonial-grid">
      <div class="testimonial-card">
        <span class="quote-mark">&ldquo;</span>
        <div class="quote">Being part of Protocol Labs has been pivotal for us at Glif. The technical, operational, and strategic advice from the network has been invaluable ‚Äî inspiring innovation.</div>
        <div class="attribution">&mdash; Jonathan Schwartz</div>
        <div class="attr-role">Co-founder & CEO, GLIF</div>
      </div>
      <div class="testimonial-card">
        <span class="quote-mark">&ldquo;</span>
        <div class="quote">The capital from PL is not just the money. We receive a lot of advice on how to think strategically. How do we do partnership and how do we go about setting up our tokenomics so that this can scale?</div>
        <div class="attribution">&mdash; Michael Cho</div>
        <div class="attr-role">Co-founder & CEO, BitRobot</div>
      </div>
      <div class="testimonial-card">
        <span class="quote-mark">&ldquo;</span>
        <div class="quote">Protocol Labs was instrumental in us being successful. Without the knowledge and network, we wouldn't have been able to focus so much on research. You need the right people who understand that.</div>
        <div class="attribution">&mdash; Rand Hindi</div>
        <div class="attr-role">Co-founder & CEO, Zama</div>
      </div>
    </div>
  </div>

  <div class="cta-section animate-in">
    <h2>Have an ask? We're here to help.</h2>
    <p>Drop it in your TG group, mention it in your investor update, or reach out directly.</p>
    <a href="#" class="cta-btn">Submit an Ask <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M5 12h14m-6-6 6 6-6 6"/></svg></a>
  </div>

</div></div>

<div class="footer">
  <div>Protocol Labs &copy; 2026 &middot; PL Asks Dashboard</div>
  <div class="updated" id="footer-updated">Live data from Google Sheet</div>
</div>

<script>
const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/1oN7wP2Bt38GuRdyr95CeSg96maH-Zbg9fZNmoFtWQNQ/export?format=csv&gid=0';

const COL_MAP = {
  'Team': 'team', 'Status': 'status', 'Category': 'category',
  'Days to First Response': 'daysResponse', 'Days to Close': 'daysClose',
  'Received': 'received', 'Team Type': 'teamType',
};

// Store all rows globally for filtering
let ALL_ROWS = [];

function parseCSVSimple(text) {
  const rows = []; let row = []; let cell = ''; let inQ = false;
  for (let i = 0; i < text.length; i++) {
    const c = text[i];
    if (c === '"') { if (inQ && text[i+1] === '"') { cell += '"'; i++; } else inQ = !inQ; }
    else if (c === ',' && !inQ) { row.push(cell.trim()); cell = ''; }
    else if ((c === '\n' || c === '\r') && !inQ) {
      row.push(cell.trim()); if (row.some(c => c)) rows.push(row);
      row = []; cell = ''; if (c === '\r' && text[i+1] === '\n') i++;
    } else { cell += c; }
  }
  if (cell || row.length) { row.push(cell.trim()); if (row.some(c => c)) rows.push(row); }
  return rows;
}

function mapRow(headers, values) {
  const obj = {};
  headers.forEach((h, i) => { const k = COL_MAP[h]; if (k && i < values.length) obj[k] = values[i]; });
  return obj;
}

function parseDate(str) {
  if (!str) return null;
  const d = new Date(str);
  return isNaN(d) ? null : d;
}

function filterByDateRange(rows, from, to) {
  return rows.filter(r => {
    const d = parseDate(r.received);
    if (!d) return false;
    if (from && d < from) return false;
    if (to && d > to) return false;
    return true;
  });
}

function calcMetrics(rows) {
  const total = rows.length;
  const teams = new Set(rows.map(r => r.team).filter(Boolean));
  const fully = rows.filter(r => (r.status||'').toLowerCase().includes('fully')).length;
  const partial = rows.filter(r => (r.status||'').toLowerCase().includes('partial')).length;
  const addressed = fully + partial;
  const addressedPct = total ? Math.round(addressed / total * 100) : 0;
  const fullyPct = total ? Math.round(fully / total * 100) : 0;
  const partialPct = total ? Math.round(partial / total * 100) : 0;
  const otherPct = 100 - fullyPct - partialPct;

  const median = arr => {
    const s = arr.filter(x => !isNaN(x) && x >= 0 && x <= 365).sort((a,b) => a-b);
    if (!s.length) return null;
    const mid = Math.floor(s.length / 2);
    return s.length % 2 ? s[mid] : (s[mid-1] + s[mid]) / 2;
  };
  const medResponse = median(rows.map(r => parseFloat(r.daysResponse)));
  const medClose = median(rows.map(r => parseFloat(r.daysClose)));

  const catLabels = {
    'Go-to-Market / Growth': 'GTM & Growth',
    'Social & Ecosystem Amplification': 'Social Amplification',
    'Hiring & Talent': 'Hiring & Talent', 'Fundraising': 'Fundraising',
    'Product & UX Feedback': 'Product & UX', 'Legal & Compliance': 'Legal & Compliance',
    'Developer Outreach & Distribution': 'Dev Outreach', 'Tokenomics': 'Tokenomics',
    'Audit Referrals': 'Audit Referrals', 'Other': 'Other',
  };
  const catMap = {};
  rows.forEach(r => {
    const cat = (r.category||'').trim(); if (!cat) return;
    const label = catLabels[cat] || cat;
    catMap[label] = (catMap[label]||0) + 1;
  });
  const categories = Object.entries(catMap).filter(([k]) => k !== 'Other')
    .sort((a,b) => b[1]-a[1]).slice(0, 8);
  const maxCat = categories.length ? categories[0][1] : 1;

  let earliest = null, latest = null;
  rows.forEach(r => {
    const d = parseDate(r.received);
    if (d) {
      if (!earliest || d < earliest) earliest = d;
      if (!latest || d > latest) latest = d;
    }
  });
  const fmt = d => d ? d.toLocaleDateString('en-US',{month:'short',year:'numeric'}) : '?';
  const sinceLabel = earliest && latest ? `${fmt(earliest)} ‚Äì ${fmt(latest)}` : 'No data';
  const disclaimerLabel = earliest && latest ? `üìä Data shown: ${fmt(earliest)} ‚Äì ${fmt(latest)}` : 'üìä No data in range';

  return { total, teams: teams.size, addressed, addressedPct,
    fullyPct, partialPct, otherPct, medResponse, medClose,
    categories, maxCat, sinceLabel, disclaimerLabel };
}

function render(m) {
  document.getElementById('s-total').textContent = m.total;
  document.getElementById('s-total-sub').textContent = m.sinceLabel;
  document.getElementById('s-teams').textContent = m.teams;
  document.getElementById('data-disclaimer').textContent = m.disclaimerLabel;

  if (m.medResponse !== null) {
    const hrs = m.medResponse * 24;
    document.getElementById('s-response').textContent = hrs < 24 ? `<${Math.max(1,Math.round(hrs))}hr` : `${m.medResponse.toFixed(1)}d`;
    document.getElementById('s-response-sub').textContent = `${m.medResponse.toFixed(1)} days median`;
  } else {
    document.getElementById('s-response').textContent = '--';
    document.getElementById('s-response-sub').textContent = 'No data';
  }
  if (m.medClose !== null) {
    document.getElementById('s-close').textContent = m.medClose <= 1 ? '<1d' : `${Math.round(m.medClose)}d`;
  } else {
    document.getElementById('s-close').textContent = '--';
  }

  const barsEl = document.getElementById('bars-container');
  barsEl.innerHTML = '';
  if (m.categories.length === 0) {
    barsEl.innerHTML = '<div style="text-align:center;color:var(--gray-80);padding:24px;font-size:14px;">No asks in this date range</div>';
  } else {
    m.categories.forEach(([label, count], i) => {
      const pct = Math.round(count / m.maxCat * 100);
      barsEl.innerHTML += `<div class="bar-row">
        <div class="bar-label">${label}</div>
        <div class="bar-track"><div class="bar-fill c${i}" style="width:0" data-width="${pct}%"></div></div>
        <div class="bar-value">${count}</div></div>`;
    });
    setTimeout(() => {
      document.querySelectorAll('.bar-fill[data-width]').forEach(b => { b.style.width = b.dataset.width; });
    }, 100);
  }

  document.getElementById('ring-pct').textContent = m.addressedPct + '%';
  const circ = 2 * Math.PI * 65;
  document.getElementById('ring').style.strokeDashoffset = circ; // reset
  setTimeout(() => {
    document.getElementById('ring').style.strokeDashoffset = circ - (circ * m.addressedPct / 100);
  }, 200);

  document.getElementById('breakdown-container').innerHTML = `
    <div class="breakdown-row"><span class="breakdown-label">Fully addressed</span>
      <span class="breakdown-val" style="color:var(--pl-green)">${m.fullyPct}%</span></div>
    <div class="breakdown-row"><span class="breakdown-label">Partially addressed</span>
      <span class="breakdown-val" style="color:#4DD396">${m.partialPct}%</span></div>
    <div class="breakdown-row"><span class="breakdown-label">Other outcomes</span>
      <span class="breakdown-val" style="color:var(--gray-80)">${m.otherPct}%</span></div>`;

  const now = new Date();
  document.getElementById('footer-updated').textContent =
    `Live from Google Sheet \u00B7 Rendered ${now.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})} at ${now.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'})}`;
}

// === DATE PICKER LOGIC ===
function applyFilter(from, to) {
  const filtered = filterByDateRange(ALL_ROWS, from, to);
  render(calcMetrics(filtered));
}

function setActivePreset(btn) {
  document.querySelectorAll('.dp-preset').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');
}

// Preset buttons
document.querySelectorAll('.dp-preset').forEach(btn => {
  btn.addEventListener('click', () => {
    setActivePreset(btn);
    const range = btn.dataset.range;
    // Clear custom inputs
    document.getElementById('dp-from').value = '';
    document.getElementById('dp-to').value = '';

    if (range === 'all') {
      render(calcMetrics(ALL_ROWS));
    } else {
      const days = parseInt(range);
      const from = new Date();
      from.setDate(from.getDate() - days);
      from.setHours(0,0,0,0);
      applyFilter(from, null);
    }
  });
});

// Custom date apply
document.getElementById('dp-apply').addEventListener('click', () => {
  const fromVal = document.getElementById('dp-from').value;
  const toVal = document.getElementById('dp-to').value;
  const from = fromVal ? new Date(fromVal + 'T00:00:00') : null;
  const to = toVal ? new Date(toVal + 'T23:59:59') : null;
  setActivePreset(null); // deselect presets
  applyFilter(from, to);
});

// === LOAD DATA ===
async function loadDashboard() {
  const loader = document.getElementById('loader');
  const errEl = document.getElementById('error');

  try {
    const resp = await fetch(SHEET_CSV_URL);
    if (!resp.ok) throw new Error(`Sheet returned ${resp.status}`);
    const text = await resp.text();
    const allRows = parseCSVSimple(text);
    if (allRows.length < 2) throw new Error('Sheet appears empty');
    const headers = allRows[0];
    ALL_ROWS = allRows.slice(1).map(v => mapRow(headers, v)).filter(r => r.status);
    render(calcMetrics(ALL_ROWS));
    loader.classList.add('hidden');
  } catch (e) {
    loader.classList.add('hidden');
    errEl.innerHTML = `<strong>Error loading sheet:</strong> ${e.message}<br>Check that the sheet sharing is set to "Anyone with the link".`;
    errEl.classList.add('show');
    // Fallback demo
    ALL_ROWS = [];
    render({
      total: 285, teams: 112, addressed: 216, addressedPct: 76,
      fullyPct: 64, partialPct: 12, otherPct: 24,
      medResponse: 0.3, medClose: 4,
      categories: [['GTM & Growth',68],['Fundraising',55],['Social Amplification',53],
        ['Hiring & Talent',36],['Product & UX',23],['Legal & Compliance',9],
        ['Dev Outreach',9],['Tokenomics',5]],
      maxCat: 68, sinceLabel: 'Fallback demo data',
      disclaimerLabel: 'üìä Fallback demo data',
    });
  }
}

const observer = new IntersectionObserver(entries => {
  entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
}, { threshold: 0.15 });
document.querySelectorAll('.animate-in').forEach(el => observer.observe(el));
loadDashboard();
</script>
</body>
</html>
